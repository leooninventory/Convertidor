<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FixFile ‚Äî Arregla archivos rotos</title>
  <style>
    body{font-family:sans-serif;max-width:700px;margin:40px auto;padding:20px;text-align:center;background:#f9fafb;color:#1f2937}
    h1{color:#4f46e5}
    .drop{border:2px dashed #d1d6e0;border-radius:12px;padding:40px;margin:20px 0;background:#f1f5f9;cursor:pointer}
    button{background:#4f46e5;color:white;border:none;padding:12px 24px;font-size:16px;border-radius:8px;cursor:pointer;margin:10px 0}
    button:disabled{background:#9ca3af;cursor:not-allowed}
    #status{margin:20px 0;font-weight:bold}
    #download{display:none;margin:20px 0;padding:12px 24px;background:#10b981;color:white;text-decoration:none;border-radius:8px}
  </style>
</head>
<body>
  <h1>üìÅ FixFile</h1>
  <p>Arrastra un archivo con nombre raro (.724Z, .tmp, etc.) y lo convertiremos a MP4.</p>
  
  <div class="drop" id="drop">üìÇ Arrastra tu archivo aqu√≠ o haz clic</div>
  <input type="file" id="file" accept="*/*" style="display:none">
  <button id="btn" disabled>Convertir a MP4</button>
  <div id="status"></div>
  <a id="dl" download>‚¨áÔ∏è Descargar MP4</a>

  <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/ffmpeg.min.js"></script>
  <script>
    const {createFFmpeg, fetchFile} = FFmpeg;
    const ffmpeg = createFFmpeg({log:false});
    let file = null;

    const drop = document.getElementById('drop');
    const fileInput = document.getElementById('file');
    const btn = document.getElementById('btn');
    const status = document.getElementById('status');
    const dl = document.getElementById('dl');

    drop.onclick = () => fileInput.click();
    fileInput.onchange = e => { if(e.target.files[0]) loadFile(e.target.files[0]); };

    ['dragover','dragenter'].forEach(e => drop.addEventListener(e, ev => { ev.preventDefault(); drop.style.background='#e5e7eb'; }));
    ['dragleave','dragend'].forEach(e => drop.addEventListener(e, () => drop.style.background='#f1f5f9'));
    drop.addEventListener('drop', ev => { ev.preventDefault(); drop.style.background='#f1f5f9'; if(ev.dataTransfer.files[0]) loadFile(ev.dataTransfer.files[0]); });

    function loadFile(f) {
      file = f;
      btn.disabled = false;
      status.textContent = `Archivo: ${f.name} (${(f.size/1024/1024).toFixed(1)} MB)`;
      dl.style.display = 'none';
    }

    btn.onclick = async () => {
      btn.disabled = true;
      status.textContent = 'Cargando conversor...';

      if (!ffmpeg.isLoaded()) await ffmpeg.load();

      status.textContent = 'Convirtiendo... ‚è≥';
      try {
        ffmpeg.FS('writeFile', 'input', await fetchFile(file));
        await ffmpeg.run('-i','input','-c:v','libx264','-c:a','aac','-y','output.mp4');
        const data = ffmpeg.FS('readFile', 'output.mp4');
        const blob = new Blob([data.buffer], {type:'video/mp4'});
        dl.href = URL.createObjectURL(blob);
        dl.download = file.name.replace(/\.[^/.]+$/, '') + '.mp4';
        dl.style.display = 'inline-block';
        status.textContent = '‚úÖ ¬°Listo! Descarga tu MP4.';
      } catch(e) {
        status.textContent = '‚ùå Error. ¬øEs un video v√°lido?';
        btn.disabled = false;
      }
    };
  </script>
</body>
</html>
